### 客户端配置流程

1. 配置Kerberos客户端

	- 安装Kerberos客户端工具：确保客户端机器上安装了Kerberos客户端工具（如**krb5-workstation**）。

	- 配置krb5.conf文件：在客户端机器上配置**/etc/krb5.conf**文件，指定KDC和Kerberos领域信息。

```
[libdefaults]
    default_realm = A.COM
    dns_lookup_realm = false
    dns_lookup_kdc = true

[realms]
    A.COM = {
        kdc = kdc.a.com
        admin_server = kdc.a.com
    }

[domain_realm]
    .a.com = A.COM
    a.com = A.COM

```

1. 配置HBase客户端

	- 配置hbase-site.xml文件：在客户端的HBase配置目录中（通常是**/etc/hbase/conf**），配置**hbase-site.xml**文件，启用Kerberos认证并指定Kerberos主体名称。

**XML**

```xml
<property>
  <name>hbase.security.authentication</name>
  <value>kerberos</value>
</property>
<property>
  <name>hbase.master.kerberos.principal</name>
  <value>hbase/_HOST@A.COM</value>
</property>
<property>
  <name>hbase.regionserver.kerberos.principal</name>
  <value>hbase/_HOST@A.COM</value>
</property>
<property>
  <name>hbase.zookeeper.quorum</name>
  <value>zk1.example.com,zk2.example.com,zk3.example.com</value>
</property>
<property>
  <name>hbase.zookeeper.property.clientPort</name>
  <value>2181</value>
</property>

```

AI-generated code. Review and use carefully. [More info on FAQ](https://www.bing.com/new#faq).

1. 获取Kerberos票据

	- 使用kinit命令获取TGT：在客户端机器上，使用**kinit**命令向KDC请求票据授予票据（TGT）。

```bash
kinit user@A.COM

```

1. 连接HBase并写入数据

	- 使用HBase客户端API：使用HBase客户端API（如Java或Python）连接到HBase集群并进行数据写入操作。

**Java**

```java
import org.apache.hadoop.conf.Configuration;
import org.apache.hadoop.hbase.HBaseConfiguration;
import org.apache.hadoop.hbase.client.Connection;
import org.apache.hadoop.hbase.client.ConnectionFactory;
import org.apache.hadoop.hbase.client.Table;
import org.apache.hadoop.hbase.client.Put;
import org.apache.hadoop.hbase.util.Bytes;

public class HBaseKerberosClient {
    public static void main(String[] args) throws Exception {
        Configuration config = HBaseConfiguration.create();
        config.set("hbase.zookeeper.quorum", "zk1.example.com,zk2.example.com,zk3.example.com");
        config.set("hbase.zookeeper.property.clientPort", "2181");
        config.set("hbase.security.authentication", "kerberos");
        config.set("hbase.master.kerberos.principal", "hbase/_HOST@A.COM");
        config.set("hbase.regionserver.kerberos.principal", "hbase/_HOST@A.COM");

        Connection connection = ConnectionFactory.createConnection(config);
        Table table = connection.getTable(TableName.valueOf("my_table"));

        Put put = new Put(Bytes.toBytes("row1"));
        put.addColumn(Bytes.toBytes("cf"), Bytes.toBytes("qual"), Bytes.toBytes("value"));
        table.put(put);

        table.close();
        connection.close();
    }
}

```

AI-generated code. Review and use carefully. [More info on FAQ](https://www.bing.com/new#faq).

### 服务端配置流程（AWS EMR）

1. 创建Kerberos安全配置

	- 在AWS EMR控制台中，创建一个包含Kerberos属性的安全配置。

1. 创建集群并指定Kerberos属性

	- 在创建EMR集群时，指定你在第一步中创建的安全配置，并配置集群特定的Kerberos属性。

```bash
aws emr create-cluster \
    --name "KerberosHBaseCluster" \
    --release-label emr-6.9.0 \
    --applications Name=HBase \
    --security-configuration "KerberosSecurityConfig" \
    --kerberos-attributes Realm=YOUR_REALM, KdcAdminPassword=YOUR_PASSWORD \
    --instance-groups InstanceGroupType=MASTER,InstanceCount=1,InstanceType=m5.xlarge \
    --instance-groups InstanceGroupType=CORE,InstanceCount=2,InstanceType=m5.xlarge

```

1. 配置主节点

	- 确保每个Kerberos认证的用户都有对应的Linux账户。

	- 配置HDFS用户目录。

	- 启用SSH的GSSAPI认证。

1. 配置HBase客户端

	- 在客户端的HBase配置目录中（通常是**/etc/hbase/conf**），配置**hbase-site.xml**文件，启用Kerberos认证并指定Kerberos主体名称。

1. 获取Kerberos票据

	- 使用**kinit**命令获取TGT：

```bash
kinit user@YOUR_REALM

```

1. 连接HBase并写入数据

	- 使用HBase客户端API（如Java或Python）连接到HBase集群并进行数据写入操作。

### 关键点

- 时间同步：确保所有节点的时间同步，以避免Kerberos认证失败。

- DNS解析：确保DNS配置正确，能够解析所有相关主机名。

- Keytab文件：确保HBase服务端正确配置了Keytab文件，以便进行Kerberos认证。

RegionServer的Keytab文件是在Kerberos配置过程中生成的，通常在设置HBase集群时由管理员创建。以下是生成和配置Keytab文件的详细步骤：

### 1. 创建服务主体

首先，需要为每个RegionServer创建一个Kerberos服务主体（principal）。这通常由Kerberos管理员使用**kadmin.local**或**kadmin**命令完成。例如：

```bash
kadmin.local -q "addprinc -randkey hbase/node2.s.com@A.COM"

```

这条命令会在KDC的数据库中添加一个新的服务主体条目**hbase/node2.s.com@A.COM**。

### 2. 生成Keytab文件

接下来，需要为这个服务主体生成一个Keytab文件，并将其分发到相应的RegionServer上。使用**ktadd**命令将服务主体的密钥添加到Keytab文件中：

```bash
kadmin.local -q "ktadd -k /etc/hbase/conf/hbase.keytab hbase/node2.s.com@A.COM"

```

这条命令会将服务主体**hbase/node2.s.com@A.COM**的密钥添加到指定的Keytab文件中（例如**/etc/hbase/conf/hbase.keytab**）。

### 3. 分发Keytab文件

将生成的Keytab文件分发到相应的RegionServer上，并确保文件权限正确，以便HBase服务能够读取和使用它。

### 4. 配置HBase服务

在RegionServer的配置文件**hbase-site.xml**中，指定Keytab文件的位置和服务主体名称。例如：

**XML**

```xml
<property>
  <name>hbase.security.authentication</name>
  <value>kerberos</value>
</property>
<property>
  <name>hbase.regionserver.kerberos.principal</name>
  <value>hbase/_HOST@A.COM</value>
</property>
<property>
  <name>hbase.regionserver.keytab.file</name>
  <value>/etc/hbase/conf/hbase.keytab</value>
</property>

```

AI-generated code. Review and use carefully. [More info on FAQ](https://www.bing.com/new#faq).
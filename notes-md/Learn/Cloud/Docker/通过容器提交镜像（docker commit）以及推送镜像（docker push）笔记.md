通过容器提交镜像（docker commit）以及推送镜像（docker push）笔记

 

在本地创建一个容器后，可以依据这个容器创建本地镜像，并可把这个镜像推送到Docker hub中，以便在网络上下载使用。

|   |   |
| - | - |
| 1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br>92<br>93<br>94<br>95<br>96<br>97<br>98<br>99<br>100<br>101<br>102<br>103<br>104<br>105<br>106<br>107<br>108<br>109<br>110<br>111<br>112<br>113<br>114<br>115<br>116<br>117<br>118<br>119<br>120<br>121<br>122<br>123 | 查看镜像<br>[root@docker-test1 ~]\# docker images<br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>docker.io/ubuntu    16.04               7aa3602ab41e        5 weeks ago         115 MB<br> <br>创建一个名为myubuntu的容器<br>[root@docker-test1 ~]\# docker run -ti --name myubuntu -d docker.io/ubuntu<br>[root@docker-test1 ~]\# docker ps<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES<br>651a8541a47d        docker.io/ubuntu    "/bin/bash"         37 seconds ago      Up 36 seconds                           myubuntu<br> <br> <br>docker commit :从容器创建一个新的镜像。<br>\# docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]<br>-a :提交的镜像作者；<br>-c :使用Dockerfile指令来创建镜像；<br>-m :提交时的说明文字；<br>-p :在commit时，将容器暂停。<br> <br>根据这个myubuntu容器提交镜像<br>[root@docker-test1 ~]\# docker commit -a "wangshibo" -m "this is test" 651a8541a47d myubuntu:v1<br>sha256:6ce4aedd12cda693d0bbb857cc443a56f9f569106e09ec61aa53563d0932ea4d<br> <br>再次查看镜像,发现镜像myubuntu:v1已经提交到本地了<br>[root@docker-test1 ~]\# docker images<br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>myubuntu            v1                  6ce4aedd12cd        59 seconds ago      84.1 MB<br>docker.io/ubuntu    16.04               7aa3602ab41e        5 weeks ago         115 MB<br> <br>在mybuntu:v1镜像推送到docker hub仓库中去<br>\# docker push [OPTIONS] NAME[:TAG]<br>OPTIONS说明：<br>--disable-content-trust :忽略镜像的校验,默认开启<br> <br> <br>首先是登录docker hub （用户名：wangshibo    密码:\*\*\*\*\*\*\*）<br>[root@docker-test1 ~]\# docker login<br>Login with your Docker ID to push and pull images from Docker Hub. If you don't have a Docker ID, head over to https://hub.docker.com to create one.<br>Username (wangshibo): wangshibo<br>Password:<br>Login Succeeded<br> <br>[root@docker-test1 ~]\# docker push wangshibo/myubuntu:v1<br>The push refers to a repository [docker.io/wangshibo/myubuntu]<br>An image does not exist locally with the tag: docker.io/wangshibo/myubuntu<br> <br>这里需要将ubuntu:v1镜像改名，在名称前加上自己的docker hub的Docker ID，即wangshibo<br> <br>[root@docker-test1 ~]\# docker tag 6ce4aedd12cd wangshibo/myubuntu:v1<br>[root@docker-test1 ~]\# docker images<br>REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE<br>myubuntu             v1                  6ce4aedd12cd        6 minutes ago       84.1 MB<br>wangshibo/myubuntu   v1                  6ce4aedd12cd        6 minutes ago       84.1 MB<br>docker.io/ubuntu     16.04               7aa3602ab41e        5 weeks ago         115 MB<br> <br>再次进行推送（注意：下面的v1的tag标签可以不打，默认是latest）。推送操作时间稍微会有一点长，耐心等待～<br>[root@docker-test1 ~]\# docker push wangshibo/myubuntu:v1           <br>The push refers to a repository [docker.io/wangshibo/myubuntu]<br>b5948ba9486d: Pushed<br>8d7ea83e3c62: Mounted from library/ubuntu<br>6a061ee02432: Mounted from library/ubuntu<br>f73b2816c52a: Mounted from library/ubuntu<br>6267b420796f: Mounted from library/ubuntu<br>a30b835850bf: Mounted from library/ubuntu<br>v1: digest: sha256:e9cd9075d262848a307c92751e1a5890d883b814a31abd118161442461a1ca2d size: 1564<br> <br>最后登录自己的Docker Hub，即https://hub.docker.com/<br>登录后，在Repositories里面就可以看到自己在上面推送的镜像wangshibo/myubuntu:v1了，这是个对外的镜像，可以在网络上下载。<br>在Docker hub上可以看到这个镜像的下载命令（注意下载时跟上tag标签，如果是latest的默认tag可以不跟）<br>也可以直接在Docker hub上删除这个镜像（Repositories-镜像-Settings-delete）<br> <br> <br>比如在另一台服务器上下载这个镜像<br>[root@kevin-test ~]\# docker pull wangshibo/myubuntu<br>Pulling repository wangshibo/myubuntu<br>Repository not found<br> <br>需要跟上tag标签<br>[root@kevin-test ~]\# docker pull wangshibo/myubuntu:v1<br>v1: Pulling from wangshibo/myubuntu<br>68e2a091ef24: Pull complete<br>8f9dd35f6299: Pull complete<br>a81a6171600b: Pull complete<br>a211a2bc7010: Pull complete<br>9e71a0b4f83a: Pull complete<br>0cf75bb335aa: Pull complete<br>c393a882769e: Pull complete<br>Digest: sha256:845fa3dcc9d0de1b9c701e1009918995da35a29012015f6c297a05edc489e018<br>Status: Downloaded newer image for wangshibo/myubuntu:v1<br>[root@kevin-test ~]\# docker  images<br>REPOSITORY           TAG                 IMAGE ID            CREATED             VIRTUAL SIZE<br>wangshibo/myubuntu   v1                  c393a882769e        12 minutes ago      84.11 MB<br> <br> <br>在本机删除这个镜像<br>[root@docker-test1 ~]\# docker images<br>REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE<br>myubuntu             v1                  6ce4aedd12cd        15 minutes ago      84.1 MB<br>wangshibo/myubuntu   v1                  6ce4aedd12cd        15 minutes ago      84.1 MB<br>docker.io/ubuntu     16.04               7aa3602ab41e        5 weeks ago         115 MB<br> <br>注意上面有两个6ce4aedd12cd的镜像ID，此时直接使用这个镜像ID是删除不掉的<br>[root@docker-test1 ~]\# docker rmi 6ce4aedd12cd<br>Error response from daemon: conflict: unable to delete 6ce4aedd12cd (must be forced) - image is referenced in multiple repositories<br> <br>应该先删除docker tag改名前的镜像，使用镜像名称删除。（一般在docker tag镜像改名后，最好删除改名前的镜像）<br>[root@docker-test1 ~]\# docker rmi myubuntu:v1<br>Untagged: myubuntu:v1<br>Untagged: wangshibo/myubuntu@sha256:e9cd9075d262848a307c92751e1a5890d883b814a31abd118161442461a1ca2d<br> <br>[root@docker-test1 ~]\# docker images<br>REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE<br>wangshibo/myubuntu   v1                  6ce4aedd12cd        15 minutes ago      84.1 MB<br>docker.io/ubuntu     16.04               7aa3602ab41e        5 weeks ago         115 MB<br> <br>这个时候就可以删除镜像ID删除了<br>[root@docker-test1 ~]\# docker rmi 6ce4aedd12cd<br>Untagged: wangshibo/myubuntu:v1<br>Deleted: sha256:6ce4aedd12cda693d0bbb857cc443a56f9f569106e09ec61aa53563d0932ea4d<br>Deleted: sha256:0ddeb6a16badd042914c2e72b9ef0331550c1cdcc4bdc6650a90cd9f57f1501b<br>[root@docker-test1 ~]\# docker images         <br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>docker.io/ubuntu    16.04               7aa3602ab41e        5 weeks ago         115 MB |


=================================删除镜像失败一例分享==================================

|   |   |
| - | - |
| 1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47 | [root@docker-test1 ~]\# docker ps<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES<br>[root@docker-test1 ~]\# docker ps -a<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES<br> <br>打算删除掉docker的nginx镜像, 但是发现这个镜像就是删除不了，加了-f强制删除也不行，一直报Error: No such image的错误，<br>最后终于找到了办法直接删除文件!<br> <br>[root@docker-test1 ~]\# docker images<br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE<br>nginx               latest              62f816a209e6        7 days ago          109MB<br> <br>[root@docker-test1 ~]\# docker rmi nginx<br>Error: No such image: nginx<br> <br>[root@docker-test1 ~]\# docker rmi 62f816a209e6<br>Error: No such image: 62f816a209e6<br> <br>[root@docker-test1 ~]\# docker rmi 62f816a209e6 -f<br>Error: No such image: 62f816a209e6<br> <br>如上,怎么都删除不掉nginx镜像!!!!!<br> <br>处理办法:<br>[root@docker-test1 ~]\# systemctl stop docker<br>[root@docker-test1 ~]\# rm -rf /var/lib/docker<br>rm: cannot remove &apos;/var/lib/docker/containers’: Device or resource busy<br> <br>删除不了的原因是: 在建立容器的时候做了相应目录的挂载，没有卸载，所以Device or resource busy<br> <br>解决办法: 查找挂载的目录并卸载<br>[root@docker-test1 ~]\# cat /proc/mounts | grep "docker"<br>/dev/mapper/centos-root /var/lib/docker/containers xfs rw,relatime,attr2,inode64,noquota 0 0<br>proc /run/docker/netns/default proc rw,nosuid,nodev,noexec,relatime 0 0<br>proc /run/docker/netns/a0626c54fd03 proc rw,nosuid,nodev,noexec,relatime 0 0<br>proc /run/docker/netns/b18072de4224 proc rw,nosuid,nodev,noexec,relatime 0 0<br>proc /run/docker/netns/b5298f643455 proc rw,nosuid,nodev,noexec,relatime 0 0<br>proc /run/docker/netns/9f5e97637c98 proc rw,nosuid,nodev,noexec,relatime 0 0<br> <br>[root@docker-test1 ~]\# umount /var/lib/docker/containers<br>[root@docker-test1 ~]\# rm -rf /var/lib/docker<br> <br>[root@docker-test1 ~]\# systemctl start docker<br> <br>再次查看就没有这个镜像了<br>[root@docker-test1 ~]\# docker images<br>REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE |


*************** 当你发现自己的才华撑不起野心时，就请安静下来学习吧！***************